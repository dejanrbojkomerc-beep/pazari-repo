
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Pazari poslednja 3 dana</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="refresh" content="300">
    <style>
        :root {
            --border: #ddd;
            --muted: #666;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 12px;
        }
        h2 {
            margin: 16px 0 4px 0;
            font-size: 18px;
        }
        h3 {
            margin: 0 0 12px 0;
            font-size: 14px;
            color: #333;
        }
        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border: 1px solid var(--border);
            border-radius: 8px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            min-width: 720px;
        }
        th, td {
            border: 1px solid var(--border);
            padding: 8px;
            text-align: right;
            white-space: nowrap;
        }
        th {
            background-color: #f5f5f5;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        td:first-child, th:first-child {
            text-align: left;
            position: sticky;
            left: 0;
            z-index: 2;
            background: #fff;
        }
        tr:nth-child(even) { background-color: #fafafa; }
        tr:last-child { font-weight: bold; background-color: #e6f7ff; }
        .controls {
            margin: 16px 0;
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }
        .cards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 8px;
        }
        .card {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            background: #fff;
        }
        .card canvas {
            width: 100% !important;
            height: 460px !important;
        }
        .legend-note {
            color: var(--muted);
            font-size: 12px;
            margin-top: 4px;
        }
        select {
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: #fff;
        }
        @media (min-width: 900px) {
            .cards { grid-template-columns: 1fr 1fr; }
        }
        @media (max-width: 600px) {
            body { font-size: 14px; }
            th, td { padding: 6px; }
        }
    </style>
</head>
<body>
    <h2>Pazari za poslednja 3 dana</h2>
    <h3>Poslednji račun u 17:40</h3>

    <div class="table-wrapper">
        <table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">2026-01-05</th>
      <th colspan="2" halign="left">2026-01-04</th>
      <th colspan="2" halign="left">2026-01-03</th>
    </tr>
    <tr>
      <th></th>
      <th>Pazar</th>
      <th>Broj računa</th>
      <th>Pazar</th>
      <th>Broj računa</th>
      <th>Pazar</th>
      <th>Broj računa</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>TC_Beo</th>
      <td>147,049.25</td>
      <td>54</td>
      <td>207,976.50</td>
      <td>74</td>
      <td>276,479.45</td>
      <td>119</td>
    </tr>
    <tr>
      <th>Arandjelovac</th>
      <td>213,274.45</td>
      <td>70</td>
      <td>305,477.51</td>
      <td>137</td>
      <td>409,488.03</td>
      <td>181</td>
    </tr>
    <tr>
      <th>Aviv</th>
      <td>95,594.16</td>
      <td>53</td>
      <td>56,825.37</td>
      <td>39</td>
      <td>126,092.62</td>
      <td>56</td>
    </tr>
    <tr>
      <th>BW_Galerija</th>
      <td>363,009.45</td>
      <td>71</td>
      <td>297,125.28</td>
      <td>103</td>
      <td>436,611.57</td>
      <td>123</td>
    </tr>
    <tr>
      <th>Banjica</th>
      <td>153,436.78</td>
      <td>99</td>
      <td>0.00</td>
      <td>0</td>
      <td>161,308.42</td>
      <td>82</td>
    </tr>
    <tr>
      <th>Borca</th>
      <td>296,056.31</td>
      <td>127</td>
      <td>220,955.17</td>
      <td>105</td>
      <td>351,539.51</td>
      <td>146</td>
    </tr>
    <tr>
      <th>Gornji_Milanovac</th>
      <td>85,328.06</td>
      <td>50</td>
      <td>348,616.87</td>
      <td>143</td>
      <td>312,332.85</td>
      <td>154</td>
    </tr>
    <tr>
      <th>Kalenic</th>
      <td>108,714.03</td>
      <td>40</td>
      <td>0.00</td>
      <td>0</td>
      <td>43,583.55</td>
      <td>20</td>
    </tr>
    <tr>
      <th>Karaburma</th>
      <td>103,558.04</td>
      <td>46</td>
      <td>141,182.78</td>
      <td>68</td>
      <td>142,539.88</td>
      <td>86</td>
    </tr>
    <tr>
      <th>Knez</th>
      <td>134,756.66</td>
      <td>32</td>
      <td>35,951.76</td>
      <td>16</td>
      <td>97,730.45</td>
      <td>46</td>
    </tr>
    <tr>
      <th>Leskovac</th>
      <td>218,191.73</td>
      <td>80</td>
      <td>191,705.58</td>
      <td>88</td>
      <td>154,317.21</td>
      <td>103</td>
    </tr>
    <tr>
      <th>Loznica</th>
      <td>134,627.41</td>
      <td>67</td>
      <td>147,538.18</td>
      <td>61</td>
      <td>313,865.23</td>
      <td>145</td>
    </tr>
    <tr>
      <th>Mladenovac</th>
      <td>106,255.96</td>
      <td>75</td>
      <td>145,742.23</td>
      <td>129</td>
      <td>213,762.88</td>
      <td>121</td>
    </tr>
    <tr>
      <th>NS_Bulevar</th>
      <td>167,694.58</td>
      <td>69</td>
      <td>0.00</td>
      <td>0</td>
      <td>155,042.60</td>
      <td>50</td>
    </tr>
    <tr>
      <th>NS_Sajam</th>
      <td>139,576.83</td>
      <td>55</td>
      <td>0.00</td>
      <td>0</td>
      <td>146,919.30</td>
      <td>57</td>
    </tr>
    <tr>
      <th>Nis</th>
      <td>363,673.58</td>
      <td>142</td>
      <td>369,187.50</td>
      <td>177</td>
      <td>529,016.29</td>
      <td>210</td>
    </tr>
    <tr>
      <th>Pancevo</th>
      <td>385,218.93</td>
      <td>153</td>
      <td>334,094.76</td>
      <td>148</td>
      <td>477,046.11</td>
      <td>219</td>
    </tr>
    <tr>
      <th>Paracin</th>
      <td>204,702.53</td>
      <td>76</td>
      <td>0.00</td>
      <td>0</td>
      <td>76,284.80</td>
      <td>35</td>
    </tr>
    <tr>
      <th>Pozarevac</th>
      <td>173,876.62</td>
      <td>70</td>
      <td>205,720.44</td>
      <td>97</td>
      <td>292,902.80</td>
      <td>145</td>
    </tr>
    <tr>
      <th>Stadion</th>
      <td>196,769.65</td>
      <td>77</td>
      <td>186,528.71</td>
      <td>88</td>
      <td>320,741.11</td>
      <td>124</td>
    </tr>
    <tr>
      <th>Subotica</th>
      <td>210,024.40</td>
      <td>93</td>
      <td>194,055.34</td>
      <td>88</td>
      <td>278,278.05</td>
      <td>115</td>
    </tr>
    <tr>
      <th>Surcin</th>
      <td>195,677.32</td>
      <td>90</td>
      <td>138,082.61</td>
      <td>65</td>
      <td>219,282.42</td>
      <td>95</td>
    </tr>
    <tr>
      <th>Valjevo</th>
      <td>202,072.13</td>
      <td>93</td>
      <td>299,892.13</td>
      <td>149</td>
      <td>343,738.11</td>
      <td>183</td>
    </tr>
    <tr>
      <th>Vrbas</th>
      <td>269,816.12</td>
      <td>97</td>
      <td>125,289.21</td>
      <td>49</td>
      <td>112,840.25</td>
      <td>59</td>
    </tr>
    <tr>
      <th>Vrsac</th>
      <td>143,794.84</td>
      <td>73</td>
      <td>78,673.10</td>
      <td>51</td>
      <td>199,738.51</td>
      <td>99</td>
    </tr>
    <tr>
      <th>Zajecar</th>
      <td>141,086.03</td>
      <td>80</td>
      <td>158,788.07</td>
      <td>85</td>
      <td>240,275.15</td>
      <td>184</td>
    </tr>
    <tr>
      <th>Zemun</th>
      <td>98,873.75</td>
      <td>42</td>
      <td>0.00</td>
      <td>0</td>
      <td>96,947.15</td>
      <td>48</td>
    </tr>
    <tr>
      <th>Ukupno</th>
      <td>5,052,709.60</td>
      <td>2074</td>
      <td>4,189,409.10</td>
      <td>1960</td>
      <td>6,528,704.30</td>
      <td>3005</td>
    </tr>
  </tbody>
</table>
    </div>

    <div class="controls">
        <label for="daySelector"><strong>Dan:</strong></label>
        <select id="daySelector"></select>
    </div>

    <div class="cards">
        <div class="card">
            <h2>Pazar po satima</h2>
            <canvas id="salesByHour"></canvas>
            <div class="legend-note">X: sat (0–23) • Y: pazar (RSD)</div>
        </div>
        <div class="card">
            <h2>Broj računa po satima</h2>
            <canvas id="receiptsByHour"></canvas>
            <div class="legend-note">X: sat (0–23) • Y: broj računa</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    const datasetsPazar = [{"label": "2026-01-05 - Pazar", "data": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2006.97, 69044.04, 211813.61, 472998.46, 611787.95, 620342.65, 843219.02, 858866.48, 780252.97, 582377.45, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], "borderColor": "#4CAF50", "backgroundColor": "#4CAF50", "borderWidth": 2}, {"label": "2026-01-04 - Pazar", "data": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 92730.18, 234409.63, 408478.73, 491518.85, 527355.78, 440180.83, 422052.83, 400972.75, 351158.49, 343636.82, 273465.5, 158094.45, 45354.259999999995, 0.0, 0.0], "borderColor": "#FF5722", "backgroundColor": "#FF5722", "borderWidth": 2}, {"label": "2026-01-03 - Pazar", "data": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 85936.91, 314426.77, 524998.3, 721986.97, 828420.35, 755126.0599999999, 745954.77, 618764.89, 622861.7999999999, 483380.45, 431593.05, 335260.33, 59993.65, 0.0, 0.0], "borderColor": "#2196F3", "backgroundColor": "#2196F3", "borderWidth": 2}];
    const datasetsRacuni = [{"label": "2026-01-05 - Broj ra\u010duna", "data": [0, 0, 0, 0, 0, 0, 0, 0, 3, 37, 94, 189, 258, 280, 323, 342, 325, 223, 0, 0, 0, 0, 0, 0], "borderColor": "#4CAF50", "backgroundColor": "#4CAF50", "borderWidth": 2}, {"label": "2026-01-04 - Broj ra\u010duna", "data": [0, 0, 0, 0, 0, 0, 0, 0, 0, 41, 113, 178, 217, 248, 209, 197, 188, 158, 179, 121, 87, 24, 0, 0], "borderColor": "#FF5722", "backgroundColor": "#FF5722", "borderWidth": 2}, {"label": "2026-01-03 - Broj ra\u010duna", "data": [0, 0, 0, 0, 0, 0, 0, 0, 4, 54, 137, 260, 322, 352, 334, 327, 290, 272, 261, 213, 149, 30, 0, 0], "borderColor": "#2196F3", "backgroundColor": "#2196F3", "borderWidth": 2}];
    const dayOptions = ["2026-01-05", "2026-01-04", "2026-01-03"];

    // Popuni dropdown sa danima
    const selector = document.getElementById('daySelector');
    dayOptions.forEach((label, idx) => {
        const opt = document.createElement('option');
        opt.value = idx;
        opt.textContent = label;
        selector.appendChild(opt);
    });
    selector.value = 0;

    let chartSales = null;
    let chartReceipts = null;

    const mkBarChart = (canvasId, dataset, yTitle) => {
        const ctx = document.getElementById(canvasId);
        return new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [...Array(24).keys()],
                datasets: [{
                    ...dataset,
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (item) => {
                                const val = item.parsed.y || 0;
                                if (yTitle.includes("RSD")) {
                                    return ' ' + val.toLocaleString('sr-RS') + ' RSD';
                                }
                                return ' ' + val.toLocaleString('sr-RS');
                            }
                        }
                    }
                },
                scales: {
                    x: { title: { display: true, text: "Sat" } },
                    y: { title: { display: true, text: yTitle } }
                }
            }
        });
    };

    function renderCharts(dayIndex) {
        if (chartSales) chartSales.destroy();
        if (chartReceipts) chartReceipts.destroy();
        chartSales = mkBarChart('salesByHour', datasetsPazar[dayIndex], 'Iznos (RSD)');
        chartReceipts = mkBarChart('receiptsByHour', datasetsRacuni[dayIndex], 'Broj računa');
    }

    selector.addEventListener('change', (e) => {
        renderCharts(parseInt(e.target.value));
    });

    // inicijalni prikaz
    renderCharts(0);
    </script>
</body>
</html>
